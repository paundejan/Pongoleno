<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pongoleno</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow: hidden;
        }
        #menu {
            text-align: center;
        }
        #menu h1 {
            font-size: 64px;
            margin-bottom: 40px;
            letter-spacing: 8px;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
        .btn {
            display: block;
            width: 300px;
            margin: 12px auto;
            padding: 16px;
            font-size: 20px;
            font-family: 'Courier New', monospace;
            background: transparent;
            color: #fff;
            border: 2px solid #fff;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 2px;
        }
        .btn:hover {
            background: #fff;
            color: #111;
        }
        #gameContainer {
            display: none;
            text-align: center;
        }
        #scoreboard {
            font-size: 48px;
            margin-bottom: 10px;
            letter-spacing: 20px;
        }
        canvas {
            border: 2px solid #fff;
            display: block;
            margin: 0 auto;
        }
        #info {
            margin-top: 12px;
            font-size: 14px;
            color: #888;
        }
        #pauseOverlay {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            letter-spacing: 4px;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
        #gameWrapper {
            position: relative;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>PONGOLENO</h1>
        <button class="btn" onclick="startGame('ai')">1 IGRAČ vs AI</button>
        <button class="btn" onclick="startGame('two')">2 IGRAČA</button>
    </div>
    <div id="gameContainer">
        <div id="scoreboard">
            <span id="score1">0</span> : <span id="score2">0</span>
        </div>
        <div id="gameWrapper">
            <canvas id="pong" width="800" height="500"></canvas>
            <div id="pauseOverlay">PAUZA</div>
        </div>
        <div id="info"></div>
    </div>

    <script>
    const canvas = document.getElementById('pong');
    const ctx = canvas.getContext('2d');
    const scoreEl1 = document.getElementById('score1');
    const scoreEl2 = document.getElementById('score2');
    const infoEl = document.getElementById('info');
    const pauseOverlay = document.getElementById('pauseOverlay');

    const WINNING_SCORE = 7;
    const PADDLE_SPEED = 6;
    const BALL_SPEED_INIT = 5;
    const BALL_SPEED_INCREMENT = 0.5;
    const AI_SPEED = 4.5;

    let mode = 'ai';
    let paused = false;
    let gameOver = false;
    let animationId;

    const ball = { x: 400, y: 250, vx: 0, vy: 0, size: 10 };
    const paddle1 = { x: 15, y: 200, w: 12, h: 100, score: 0 };
    const paddle2 = { x: 773, y: 200, w: 12, h: 100, score: 0 };
    const keys = {};

    function startGame(m) {
        mode = m;
        document.getElementById('menu').style.display = 'none';
        document.getElementById('gameContainer').style.display = 'block';

        if (mode === 'ai') {
            infoEl.textContent = 'W/S — kretanje  |  P — pauza  |  ESC — meni';
        } else {
            infoEl.textContent = 'W/S — levi igrač  |  ↑/↓ — desni igrač  |  P — pauza  |  ESC — meni';
        }

        resetAll();
        gameLoop();
    }

    function resetAll() {
        paddle1.score = 0;
        paddle2.score = 0;
        paddle1.y = 200;
        paddle2.y = 200;
        gameOver = false;
        paused = false;
        pauseOverlay.style.display = 'none';
        updateScore();
        resetBall();
    }

    function resetBall() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        const angle = (Math.random() * Math.PI / 3) - Math.PI / 6;
        const dir = Math.random() > 0.5 ? 1 : -1;
        ball.vx = dir * BALL_SPEED_INIT * Math.cos(angle);
        ball.vy = BALL_SPEED_INIT * Math.sin(angle);
    }

    function updateScore() {
        scoreEl1.textContent = paddle1.score;
        scoreEl2.textContent = paddle2.score;
    }

    function movePaddles() {
        // Player 1 (W/S)
        if (keys['w'] || keys['W']) paddle1.y -= PADDLE_SPEED;
        if (keys['s'] || keys['S']) paddle1.y += PADDLE_SPEED;

        // Player 2 or AI
        if (mode === 'two') {
            if (keys['ArrowUp']) paddle2.y -= PADDLE_SPEED;
            if (keys['ArrowDown']) paddle2.y += PADDLE_SPEED;
        } else {
            // AI
            const center = paddle2.y + paddle2.h / 2;
            if (ball.vx > 0) {
                if (center < ball.y - 20) paddle2.y += AI_SPEED;
                else if (center > ball.y + 20) paddle2.y -= AI_SPEED;
            } else {
                // Move toward center when ball going away
                if (center < canvas.height / 2 - 10) paddle2.y += AI_SPEED * 0.5;
                else if (center > canvas.height / 2 + 10) paddle2.y -= AI_SPEED * 0.5;
            }
        }

        // Clamp paddles
        paddle1.y = Math.max(0, Math.min(canvas.height - paddle1.h, paddle1.y));
        paddle2.y = Math.max(0, Math.min(canvas.height - paddle2.h, paddle2.y));
    }

    function moveBall() {
        ball.x += ball.vx;
        ball.y += ball.vy;

        // Top/bottom walls
        if (ball.y - ball.size < 0) {
            ball.y = ball.size;
            ball.vy = -ball.vy;
        }
        if (ball.y + ball.size > canvas.height) {
            ball.y = canvas.height - ball.size;
            ball.vy = -ball.vy;
        }

        // Paddle 1 collision
        if (
            ball.x - ball.size < paddle1.x + paddle1.w &&
            ball.x + ball.size > paddle1.x &&
            ball.y > paddle1.y &&
            ball.y < paddle1.y + paddle1.h &&
            ball.vx < 0
        ) {
            ball.vx = -ball.vx;
            ball.x = paddle1.x + paddle1.w + ball.size;
            const hit = (ball.y - (paddle1.y + paddle1.h / 2)) / (paddle1.h / 2);
            ball.vy = hit * 5;
            speedUp();
        }

        // Paddle 2 collision
        if (
            ball.x + ball.size > paddle2.x &&
            ball.x - ball.size < paddle2.x + paddle2.w &&
            ball.y > paddle2.y &&
            ball.y < paddle2.y + paddle2.h &&
            ball.vx > 0
        ) {
            ball.vx = -ball.vx;
            ball.x = paddle2.x - ball.size;
            const hit = (ball.y - (paddle2.y + paddle2.h / 2)) / (paddle2.h / 2);
            ball.vy = hit * 5;
            speedUp();
        }

        // Score
        if (ball.x < 0) {
            paddle2.score++;
            updateScore();
            checkWin() || resetBall();
        }
        if (ball.x > canvas.width) {
            paddle1.score++;
            updateScore();
            checkWin() || resetBall();
        }
    }

    function speedUp() {
        const speed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
        const newSpeed = speed + BALL_SPEED_INCREMENT;
        const ratio = newSpeed / speed;
        ball.vx *= ratio;
        ball.vy *= ratio;
    }

    function checkWin() {
        if (paddle1.score >= WINNING_SCORE || paddle2.score >= WINNING_SCORE) {
            gameOver = true;
            return true;
        }
        return false;
    }

    function draw() {
        // Background
        ctx.fillStyle = '#111';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Center line
        ctx.setLineDash([10, 10]);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 0);
        ctx.lineTo(canvas.width / 2, canvas.height);
        ctx.stroke();
        ctx.setLineDash([]);

        // Ball
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.size, 0, Math.PI * 2);
        ctx.fill();

        // Paddles
        ctx.fillStyle = '#fff';
        ctx.fillRect(paddle1.x, paddle1.y, paddle1.w, paddle1.h);
        ctx.fillRect(paddle2.x, paddle2.y, paddle2.w, paddle2.h);

        // Game over text
        if (gameOver) {
            ctx.fillStyle = '#fff';
            ctx.font = '48px Courier New';
            ctx.textAlign = 'center';
            const winner = paddle1.score >= WINNING_SCORE
                ? (mode === 'two' ? 'IGRAČ 1' : 'TI')
                : (mode === 'two' ? 'IGRAČ 2' : 'AI');
            ctx.fillText(winner + ' POBEĐUJE!', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '20px Courier New';
            ctx.fillText('ENTER — nova igra  |  ESC — meni', canvas.width / 2, canvas.height / 2 + 30);
        }
    }

    function gameLoop() {
        if (!paused && !gameOver) {
            movePaddles();
            moveBall();
        }
        draw();
        animationId = requestAnimationFrame(gameLoop);
    }

    function backToMenu() {
        cancelAnimationFrame(animationId);
        document.getElementById('menu').style.display = 'block';
        document.getElementById('gameContainer').style.display = 'none';
        pauseOverlay.style.display = 'none';
    }

    document.addEventListener('keydown', (e) => {
        keys[e.key] = true;

        if (e.key === 'p' || e.key === 'P') {
            if (!gameOver) {
                paused = !paused;
                pauseOverlay.style.display = paused ? 'block' : 'none';
            }
        }

        if (e.key === 'Escape') {
            backToMenu();
        }

        if (e.key === 'Enter' && gameOver) {
            resetAll();
        }

        if (['ArrowUp', 'ArrowDown', ' '].includes(e.key)) {
            e.preventDefault();
        }
    });

    document.addEventListener('keyup', (e) => {
        keys[e.key] = false;
    });
    </script>
</body>
</html>
